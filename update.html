<!DOCTYPE html>
<html>
    <head>
     <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <title>AUDIT REPORT-UPDATE PAGE</title>
     <link rel="stylesheet" href="D:\Internship\Internship_projects\Titan_audit_website\resources\CSS\index.css">   
    </head>
<body>
    <div class="top">
        <div class="pic">
            <img src= "data:image/png;base64,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" width="100" height="100">
        </div>
        <div class="welcome">
            <p><b>UPDATE SELF AUDIT REPORT</b></p>
        </div>
    </div>
    <div><button class="homes"><a href=home.html style="color:#000000; text-decoration: none;"><b> &#8592; BACK HOME</b></a></button>
    </div>
    <br><br>
    <div class="instructions"><i><b>POINTS TO BE NOTED:</b>
        <ul>
            <li>SAVE button would save the changes made and store it as CSV file.</li> 
            <li>EXPORT button would download the table as PDF.</li>
            <li>EXPORT can be done only when all the datas has been entered.</li>
        </ul></i>
    </div>
    <center>
    <section class="up">
        <div style="color:black;font-size:18px;" class="text">
        <b>OPEN THE FILE: </b>
        <input type="file" accept=".csv" id="csvInput">
    </div>
    <br>
    <fieldset style="width: fit-content;font-size:18px;color:black">
        <form>
            <label><b>NAME: </b>
            <input type="text" name="names" id="names"/></label>
            <label><b>DATE: </b>
            <input type="date" name="dates" id="dates"/></label>
        </form>
    </fieldset> 
    <br>
    <table id="data-table" border="1" class="data-table" style="border-color:black;border-collapse:collapse;width:80%;text-align:center;margin:auto;"></table>
    <br>
    <button class="subbs" id="convertCsv"><b>SAVE as CSV</b></button>
    <button class="subbs" id="downloadPdf"><b>EXPORT as PDF</b></button>
</center>
</section>
<style>
    table {
    border-collapse: collapse;
    border: 1px solid #ddd;
  }
  
  th, td {
    padding: 5px;
    text-align: center;
  }
  
  .hidden {
    display: none;
  }
</style>
<script>
    const data = [];
    const table = document.getElementById('data-table');
    const csvInput = document.getElementById('csvInput');
    const convertCsvBtn = document.getElementById('convertCsv');
    const downloadPdfBtn = document.getElementById('downloadPdf');
    
    csvInput.addEventListener('change', () => {
      const file = csvInput.files[0];
      const reader = new FileReader();
      reader.readAsText(file);
      reader.onload = () => {
        const rows = reader.result.split('\n');
        for (const row of rows) {
          const values = row.split(',');
          data.push(values);
        }
        displayTable();
      };
    });
    
    function displayTable() {
          table.innerHTML = '';
        
          const headerRow = document.createElement('tr');
          for (const header of ['Sl.no', 'Marks', 'Remarks', 'Action taken on']) {
            const headerCell = document.createElement('th');
            headerCell.innerText = header;
            headerRow.appendChild(headerCell);
          }
          table.appendChild(headerRow);
        
          for (let i = 1; i < data.length; i++) {
            const row = document.createElement('tr');
            for (let j = 0; j < data[i].length; j++) {
              const cell = document.createElement('td');
              if (j === 3) {
                if (data[i][j]) {
                  cell.innerText = data[i][j]; 
                } else {
                  const dateInput = document.createElement('input');
                  dateInput.type = 'date';
                  dateInput.value = ''; 
                  cell.appendChild(dateInput); 
        
                  dateInput.addEventListener('change', () => {
                    data[i][j] = dateInput.value;
                    cell.innerText = dateInput.value; 
                    saveToLocalStorage();
                  });
                }
              } else {
                cell.innerText = data[i][j];
              }
              row.appendChild(cell);
            }
            table.appendChild(row);
          }
        }
    
    function saveToLocalStorage() {
      localStorage.setItem('data', JSON.stringify(data));
    }
    
    convertCsvBtn.addEventListener('click', () => {
      const csvContent = data.map(row => row.join(',')).join('\n');
      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8' });
      const url = window.URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      var today = new Date();
      var dd = String(today.getDate());
      var mm = String(today.getMonth() + 1); 
      var yyyy = String(today.getFullYear());
      today = dd + '-' + mm + '-' + yyyy;
      link.download = 'self-audit-('+today+').csv';
      link.click();
      window.URL.revokeObjectURL(url);
    });
    
    downloadPdfBtn.addEventListener('click', () => {
      localStorage.clear();
      var names=document.getElementById('names').value;
      var dates=document.getElementById('dates').value;
      localStorage.setItem('nam',names);
      localStorage.setItem('dat',dates);
      console.log(localStorage);

      var namee=localStorage.getItem('nam');
      var datee=localStorage.getItem('dat');

      const allCellsFilled = data.every(row => row[3]);
      if (!allCellsFilled) {
        alert('Please fill the data in all Action to be taken columns.');
        return;
      }

      var newWindow=window.open();
      newWindow.document.write('<html><head><style>body {background-size: cover;}</style></head><body>');
      newWindow.document.write('<br><br><br><h5 style="font-size:15px;display:inline;margin-left:25px;margin-right:80px;">DATE: '+datee+'</h5>');
      newWindow.document.write('<h5 style="font-size:15px;display:inline;text-align:center;margin-left:auto;margin-right:auto;">NAME: '+namee+'</h5>');
      newWindow.document.write('<h5 style="font-size:15px;display:inline;margin-right:5px;margin-left:35px;">TITLE: 5S ROUGH SELF AUDIT SHEET</h5>');
      newWindow.document.write('<br><br><center><table style="border:2px solid black; border-collapse:collapse; width:100%;margin:auto;text-align:center;"'+table.outerHTML+'</table>');
      newWindow.document.write('</center><h5 style="float:right;font-size:15px;margin-right:200px">SIGNATURE:</h5></body></html>');
      newWindow.print();
      newWindow.close();
    });

</script>
</body>
</html>
